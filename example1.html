<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Overlays within Street View</title>
    <style>
      html, body, #map-canvas {
        height: 100%;
        margin: 0px;
        padding: 0px
      }
      #panel {
        position: absolute;
        top: 5px;
        left: 50%;
        margin-left: -180px;
        z-index: 5;
        background-color: #fff;
        padding: 5px;
        border: 1px solid #999;
      }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
    <script>
    var intersection = new google.maps.LatLng(40.7210690835, -73.9981985092),
        places = [
          { icon: 'http://visionzero-dev.herokuapp.com/static/css/images/markers/icon-dot-yield.png', ll: new google.maps.LatLng(40.721180, -73.998258) },
          { icon: 'http://visionzero-dev.herokuapp.com/static/css/images/markers/icon-dot-yield.png', ll: new google.maps.LatLng(40.721164, -73.998225) },
          { icon: 'http://visionzero-dev.herokuapp.com/static/css/images/markers/icon-dot-yield.png', ll: new google.maps.LatLng(40.721135, -73.998239) },
          { icon: 'http://visionzero-dev.herokuapp.com/static/css/images/markers/icon-dot-yield.png', ll: new google.maps.LatLng(40.721184, -73.998292) },
          { icon: 'http://visionzero-dev.herokuapp.com/static/css/images/markers/icon-dot-yield.png', ll: new google.maps.LatLng(40.721174, -73.998244) },
          { icon: 'http://visionzero-dev.herokuapp.com/static/css/images/markers/icon-dot-speeding.png', ll: new google.maps.LatLng(40.721162, -73.998436) }
        ],
        contentString = '<div> <header class="place-header clearfix"> <h1>Failure to yield</h1> <span class="place-submission-details"> <strong class="point-submitter"> <img src="http://visionzero-dev.herokuapp.com/static//css/images/user-50.png" class="avatar"> reported by Lora Tenenbaum </strong> <time datetime="2014-04-30T16:34:56.456897+00:00" class="response-date"><a href="http://visionzero-dev.herokuapp.com//place/181453">6 days ago</a></time> </span> </header> <section class="place-items"> <div class="place-item place-item-description"> <span class="place-label place-label-description"></span> <p class="place-value place-value-description">This has been a constant problem as cars (most on their way to the Holland Tunnel) turning from Lafayette onto Broome fail to yield to pedestrians crossing.  What we need is a conflict free crossing, paired with a countdown light for pedestrians.  Heavy tourist traffic.</p> </div> </section> </div>',
        infowindow = new google.maps.InfoWindow({
          content: contentString
        }),
        map, panorama;


    function initialize() {

      // Set up the map
      var mapOptions = {
            center: intersection,
            zoom: 18,
            streetViewControl: false
          },
          i, marker;

      map = new google.maps.Map(document.getElementById('map-canvas'),
          mapOptions);


      // We get the map's default panorama and set up some defaults.
      // Note that we don't yet set it visible.
      panorama = map.getStreetView();
      panorama.setOptions({
        addressControl: false,
        clickToGo: false,
        scrollwheel: false,
        linksControl: false,
        disableDoubleClickZoom: false,
        zoomControlOptions: {
          style: google.maps.ZoomControlStyle.SMALL
        }
      })
      panorama.setPosition(intersection);
      panorama.setPov(/** @type {google.maps.StreetViewPov} */({
        heading: 0,
        pitch: 0
      }));

      // Setup the markers on the map
      for (i=0; i<places.length; i++) {
        marker = new google.maps.Marker({
          position: places[i].ll,
          map: map,
          icon: places[i].icon,
          title: 'Place ' + (i+1)
        });

        (function(m) {

          google.maps.event.addListener(m, 'click', function() {
            infowindow.open(panorama, m);
          });

        })(marker);
      }

      panorama.setVisible(true);
    }

    google.maps.event.addDomListener(window, 'load', initialize);
    </script>
  </head>
  <body>
    <div id="map-canvas"></div>
  </body>
</html>